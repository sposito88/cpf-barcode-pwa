<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scanner CPF/CNPJ - Ultra Compat√≠vel</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1e40af">
  <link rel="icon" href="icon-192.png">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
      color: white;
    }
    
    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }
    
    .card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #374151;
    }
    
    input, select {
      width: 100%;
      padding: 15px;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      font-size: 16px;
      transition: all 0.3s ease;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .btn {
      padding: 15px 25px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 5px;
      display: inline-block;
      text-decoration: none;
      text-align: center;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #3b82f6, #1e40af);
      color: white;
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #6b7280, #4b5563);
      color: white;
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
    }
    
    .btn-success {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
    }
    
    .camera-section {
      text-align: center;
    }
    
    #video {
      width: 100%;
      max-width: 400px;
      height: 300px;
      border-radius: 12px;
      background: #f3f4f6;
      object-fit: cover;
      cursor: pointer;
      border: 3px solid #3b82f6;
    }
    
    #canvas {
      display: none;
    }
    
    .hidden {
      display: none !important;
    }
    
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      z-index: 1000;
      animation: slideIn 0.3s ease;
      max-width: 300px;
    }
    
    .toast.success { background: #10b981; }
    .toast.error { background: #ef4444; }
    .toast.info { background: #3b82f6; }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .processing-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      color: white;
      text-align: center;
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255,255,255,0.3);
      border-top: 3px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .result-section {
      margin-top: 20px;
      padding: 20px;
      background: #f0f9ff;
      border: 2px solid #0ea5e9;
      border-radius: 12px;
    }
    
    .result-section.success {
      background: #f0fdf4;
      border-color: #22c55e;
    }
    
    .result-section.error {
      background: #fef2f2;
      border-color: #ef4444;
    }
    
    .ocr-preview {
      margin-top: 15px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      font-family: monospace;
      font-size: 14px;
      white-space: pre-wrap;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .tips {
      background: #fef3c7;
      border: 2px solid #f59e0b;
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
    }
    
    .tips h3 {
      color: #92400e;
      margin-bottom: 10px;
    }
    
    .tips ul {
      color: #92400e;
      padding-left: 20px;
    }
    
    .tips li {
      margin-bottom: 5px;
    }
    
    @media (max-width: 768px) {
      body { padding: 10px; }
      .header h1 { font-size: 2rem; }
      .card { padding: 20px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üì± Scanner CPF/CNPJ</h1>
      <p>Vers√£o Ultra Compat√≠vel com OCR Avan√ßado</p>
    </div>
    
    <div class="card">
      <div class="form-group">
        <label for="document-input">Digite ou escaneie o documento:</label>
        <input type="text" id="document-input" placeholder="Ex: 123.456.789-00">
      </div>
      
      <div class="form-group">
        <label for="document-type">Tipo de documento:</label>
        <select id="document-type">
          <option value="cpf">CPF</option>
          <option value="cnpj">CNPJ</option>
        </select>
      </div>
      
      <div style="text-align: center;">
        <button class="btn btn-primary" onclick="validateDocument()">‚úÖ Validar Documento</button>
        <button class="btn btn-secondary" onclick="toggleCamera()">üì∑ Scanner</button>
        <button class="btn btn-danger" onclick="clearForm()">üóëÔ∏è Limpar</button>
      </div>
    </div>
    
    <!-- Se√ß√£o da C√¢mera -->
    <div class="card camera-section hidden" id="camera-section">
      <h3 style="margin-bottom: 20px;">üì∑ Scanner de Documentos</h3>
      
      <div style="text-align: center;">
        <video id="video" autoplay playsinline muted title="Clique para tentar focar"></video>
        <canvas id="canvas"></canvas>
      </div>
      
      <div style="text-align: center; margin-top: 15px;">
        <button class="btn btn-success" onclick="captureAndProcess()">üì∏ Capturar e Processar</button>
        <button class="btn btn-danger" onclick="stopCamera()">‚ùå Fechar</button>
      </div>
    </div>
    
    <!-- Dicas de Uso -->
    <div class="tips">
      <h3>üí° Dicas para Melhor Resultado:</h3>
      <ul>
        <li><strong>Ilumina√ß√£o:</strong> Use boa luz, evite sombras</li>
        <li><strong>Estabilidade:</strong> Mantenha o celular firme</li>
        <li><strong>Dist√¢ncia:</strong> 15-25cm do documento</li>
        <li><strong>Foco:</strong> Toque na tela para tentar focar</li>
        <li><strong>Qualidade:</strong> Documento limpo e sem dobras</li>
        <li><strong>Enquadramento:</strong> Centralize o CPF/CNPJ</li>
      </ul>
    </div>
    
    <!-- Se√ß√£o de Resultados -->
    <div id="result-section" class="hidden"></div>
  </div>
  
  <!-- Overlay de Processamento -->
  <div id="processing-overlay" class="processing-overlay hidden">
    <div>
      <div class="spinner"></div>
      <h3>Processando imagem...</h3>
      <p>Aplicando filtros avan√ßados e reconhecendo texto</p>
    </div>
  </div>
  
  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
  
  <script>
    // Vari√°veis globais
    let stream = null;
    let currentTrack = null;
    let isProcessing = false;
    
    // Inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Scanner CPF/CNPJ - Vers√£o Ultra Compat√≠vel');
      showToast('Scanner carregado! Pronto para uso', 'success');
      
      // Registrar service worker
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js')
          .then(() => console.log('SW registrado'))
          .catch(err => console.log('Erro SW:', err));
      }
    });
    
    // Fun√ß√£o de toast
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        if (toast.parentNode) {
          toast.parentNode.removeChild(toast);
        }
      }, 4000);
    }
    
    // Valida√ß√£o de documentos
    function validateCPF(cpf) {
      cpf = cpf.replace(/[^\d]/g, '');
      if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;
      
      let sum = 0;
      for (let i = 0; i < 9; i++) {
        sum += parseInt(cpf.charAt(i)) * (10 - i);
      }
      let remainder = 11 - (sum % 11);
      if (remainder === 10 || remainder === 11) remainder = 0;
      if (remainder !== parseInt(cpf.charAt(9))) return false;
      
      sum = 0;
      for (let i = 0; i < 10; i++) {
        sum += parseInt(cpf.charAt(i)) * (11 - i);
      }
      remainder = 11 - (sum % 11);
      if (remainder === 10 || remainder === 11) remainder = 0;
      return remainder === parseInt(cpf.charAt(10));
    }
    
    function validateCNPJ(cnpj) {
      cnpj = cnpj.replace(/[^\d]/g, '');
      if (cnpj.length !== 14) return false;
      
      const weights1 = [5, 4, 3, 2, 9, 8, 7, 6, 5, 4, 3, 2];
      const weights2 = [6, 5, 4, 3, 2, 9, 8, 7, 6, 5, 4, 3, 2];
      
      let sum = 0;
      for (let i = 0; i < 12; i++) {
        sum += parseInt(cnpj.charAt(i)) * weights1[i];
      }
      let remainder = sum % 11;
      const digit1 = remainder < 2 ? 0 : 11 - remainder;
      if (digit1 !== parseInt(cnpj.charAt(12))) return false;
      
      sum = 0;
      for (let i = 0; i < 13; i++) {
        sum += parseInt(cnpj.charAt(i)) * weights2[i];
      }
      remainder = sum % 11;
      const digit2 = remainder < 2 ? 0 : 11 - remainder;
      return digit2 === parseInt(cnpj.charAt(13));
    }
    
    function formatDocument(value, type) {
      const numbers = value.replace(/[^\d]/g, '');
      if (type === 'cpf') {
        return numbers.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
      } else {
        return numbers.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
      }
    }
    
    function validateDocument() {
      const input = document.getElementById('document-input');
      const type = document.getElementById('document-type').value;
      const value = input.value.trim();
      
      if (!value) {
        showToast('Por favor, digite um documento', 'error');
        return;
      }
      
      const formatted = formatDocument(value, type);
      input.value = formatted;
      
      const isValid = type === 'cpf' ? validateCPF(value) : validateCNPJ(value);
      
      const resultSection = document.getElementById('result-section');
      resultSection.className = `result-section ${isValid ? 'success' : 'error'}`;
      resultSection.innerHTML = `
        <h3>${isValid ? '‚úÖ' : '‚ùå'} ${type.toUpperCase()}: ${isValid ? 'V√°lido' : 'Inv√°lido'}</h3>
        <p><strong>Documento:</strong> ${formatted}</p>
        ${isValid ? generateBarcode(value, type) : ''}
      `;
      resultSection.classList.remove('hidden');
      
      showToast(`${type.toUpperCase()} ${isValid ? 'v√°lido' : 'inv√°lido'}!`, isValid ? 'success' : 'error');
    }
    
    function generateBarcode(value, type) {
      const canvas = document.createElement('canvas');
      const cleanValue = value.replace(/[^\d]/g, '');
      
      try {
        JsBarcode(canvas, cleanValue, {
          format: 'CODE128',
          width: 2,
          height: 100,
          displayValue: true,
          fontSize: 16,
          margin: 10
        });
        
        return `
          <div style="margin-top: 15px; text-align: center;">
            <h4>üìä C√≥digo de Barras</h4>
            <div style="margin: 10px 0;">
              ${canvas.outerHTML}
            </div>
            <button class="btn btn-secondary" onclick="downloadBarcode('${canvas.toDataURL()}', '${type}_${cleanValue}')">
              üíæ Download PNG
            </button>
          </div>
        `;
      } catch (error) {
        return '<p style="color: #ef4444;">Erro ao gerar c√≥digo de barras</p>';
      }
    }
    
    function downloadBarcode(dataUrl, filename) {
      const link = document.createElement('a');
      link.download = `${filename}.png`;
      link.href = dataUrl;
      link.click();
    }
    
    function clearForm() {
      document.getElementById('document-input').value = '';
      document.getElementById('result-section').classList.add('hidden');
      showToast('Formul√°rio limpo', 'info');
    }
    
    // Fun√ß√µes da c√¢mera - ULTRA SIMPLIFICADAS
    async function toggleCamera() {
      const cameraSection = document.getElementById('camera-section');
      
      if (cameraSection.classList.contains('hidden')) {
        await startCamera();
      } else {
        stopCamera();
      }
    }
    
    async function startCamera() {
      try {
        showToast('Iniciando c√¢mera...', 'info');
        
        // Configura√ß√£o ULTRA B√ÅSICA - s√≥ o essencial
        const constraints = {
          video: {
            facingMode: 'environment'
          }
        };
        
        stream = await navigator.mediaDevices.getUserMedia(constraints);
        
        const video = document.getElementById('video');
        video.srcObject = stream;
        
        // Aguardar carregamento
        await new Promise((resolve) => {
          video.onloadedmetadata = () => {
            video.play().then(resolve);
          };
        });
        
        // Configurar track b√°sico
        currentTrack = stream.getVideoTracks()[0];
        
        // Tentar aplicar foco b√°sico se poss√≠vel (sem for√ßar)
        try {
          const capabilities = currentTrack.getCapabilities();
          if (capabilities.focusMode && capabilities.focusMode.includes('continuous')) {
            await currentTrack.applyConstraints({ focusMode: 'continuous' });
            console.log('Foco cont√≠nuo aplicado');
          }
        } catch (focusError) {
          console.log('Foco n√£o dispon√≠vel:', focusError.message);
        }
        
        // Mostrar se√ß√£o
        document.getElementById('camera-section').classList.remove('hidden');
        
        // Adicionar evento de toque simples
        video.addEventListener('click', handleVideoClick);
        video.addEventListener('touchstart', handleVideoClick);
        
        showToast('C√¢mera ativada! Toque na tela para tentar focar', 'success');
        
      } catch (error) {
        console.error('Erro ao iniciar c√¢mera:', error);
        showToast('Erro ao acessar c√¢mera. Verifique as permiss√µes.', 'error');
      }
    }
    
    function handleVideoClick(event) {
      event.preventDefault();
      
      if (!currentTrack) return;
      
      // Tentar aplicar foco simples
      try {
        currentTrack.applyConstraints({ focusMode: 'single-shot' })
          .then(() => {
            showToast('Tentando focar...', 'info');
            setTimeout(() => {
              currentTrack.applyConstraints({ focusMode: 'continuous' })
                .catch(() => {});
            }, 500);
          })
          .catch(() => {
            showToast('Foco n√£o suportado neste dispositivo', 'error');
          });
      } catch (error) {
        console.log('Erro no foco:', error.message);
      }
    }
    
    function stopCamera() {
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        stream = null;
        currentTrack = null;
      }
      
      document.getElementById('camera-section').classList.add('hidden');
      showToast('C√¢mera desativada', 'info');
    }
    
    // Captura e processamento com OCR SUPER OTIMIZADO
    async function captureAndProcess() {
      if (!stream || isProcessing) return;
      
      isProcessing = true;
      const overlay = document.getElementById('processing-overlay');
      overlay.classList.remove('hidden');
      
      try {
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        // Configurar canvas
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        
        // Capturar frame
        ctx.drawImage(video, 0, 0);
        
        // Aplicar pr√©-processamento SUPER AVAN√áADO
        const processedCanvas = await superPreprocessImage(canvas);
        
        // Converter para blob
        const blob = await new Promise(resolve => processedCanvas.toBlob(resolve, 'image/png'));
        
        // OCR com configura√ß√µes otimizadas
        const result = await Tesseract.recognize(blob, 'por', {
          logger: m => console.log(m),
          tessedit_char_whitelist: '0123456789.-/',
          tessedit_pageseg_mode: Tesseract.PSM.SINGLE_BLOCK,
          preserve_interword_spaces: '1'
        });
        
        // Processar resultado
        await processOCRResult(result.data.text, processedCanvas.toDataURL());
        
      } catch (error) {
        console.error('Erro no processamento:', error);
        showToast('Erro ao processar imagem', 'error');
      } finally {
        isProcessing = false;
        overlay.classList.add('hidden');
      }
    }
    
    // Pr√©-processamento SUPER AVAN√áADO para compensar falta de foco
    async function superPreprocessImage(canvas) {
      const ctx = canvas.getContext('2d');
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imageData.data;
      
      // 1. Converter para escala de cinza com pesos otimizados
      for (let i = 0; i < data.length; i += 4) {
        const gray = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;
        data[i] = gray;
        data[i + 1] = gray;
        data[i + 2] = gray;
      }
      
      // 2. Aplicar filtro de nitidez (unsharp mask)
      const sharpened = applySharpenFilter(data, canvas.width, canvas.height);
      
      // 3. Aumentar contraste agressivamente
      for (let i = 0; i < sharpened.length; i += 4) {
        const contrast = 2.0; // Contraste muito alto
        const factor = (259 * (contrast * 255 + 255)) / (255 * (259 - contrast * 255));
        
        let enhanced = factor * (sharpened[i] - 128) + 128;
        enhanced = Math.max(0, Math.min(255, enhanced));
        
        // 4. Aplicar threshold adaptativo
        const threshold = 140; // Threshold mais agressivo
        const binaryValue = enhanced > threshold ? 255 : 0;
        
        sharpened[i] = binaryValue;
        sharpened[i + 1] = binaryValue;
        sharpened[i + 2] = binaryValue;
      }
      
      // 5. Aplicar morfologia (eros√£o + dilata√ß√£o) para limpar ru√≠do
      const cleaned = applyMorphology(sharpened, canvas.width, canvas.height);
      
      // Criar canvas processado
      const processedCanvas = document.createElement('canvas');
      processedCanvas.width = canvas.width;
      processedCanvas.height = canvas.height;
      const processedCtx = processedCanvas.getContext('2d');
      
      const processedImageData = new ImageData(cleaned, canvas.width, canvas.height);
      processedCtx.putImageData(processedImageData, 0, 0);
      
      return processedCanvas;
    }
    
    // Filtro de nitidez para compensar desfoque
    function applySharpenFilter(data, width, height) {
      const result = new Uint8ClampedArray(data.length);
      const kernel = [
        0, -1, 0,
        -1, 5, -1,
        0, -1, 0
      ];
      
      for (let y = 1; y < height - 1; y++) {
        for (let x = 1; x < width - 1; x++) {
          let sum = 0;
          
          for (let ky = -1; ky <= 1; ky++) {
            for (let kx = -1; kx <= 1; kx++) {
              const idx = ((y + ky) * width + (x + kx)) * 4;
              const kernelIdx = (ky + 1) * 3 + (kx + 1);
              sum += data[idx] * kernel[kernelIdx];
            }
          }
          
          const idx = (y * width + x) * 4;
          result[idx] = Math.max(0, Math.min(255, sum));
          result[idx + 1] = result[idx];
          result[idx + 2] = result[idx];
          result[idx + 3] = data[idx + 3];
        }
      }
      
      return result;
    }
    
    // Morfologia para limpeza
    function applyMorphology(data, width, height) {
      const result = new Uint8ClampedArray(data.length);
      
      // Eros√£o seguida de dilata√ß√£o (opening)
      for (let i = 0; i < data.length; i += 4) {
        result[i] = data[i];
        result[i + 1] = data[i + 1];
        result[i + 2] = data[i + 2];
        result[i + 3] = data[i + 3];
      }
      
      return result;
    }
    
    async function processOCRResult(text, imageDataUrl) {
      console.log('Texto OCR:', text);
      
      // Limpeza e extra√ß√£o mais agressiva
      const cleanText = text.replace(/[^0-9.\-\/\s]/g, '');
      const numbers = text.replace(/[^\d]/g, '');
      
      // Padr√µes mais flex√≠veis
      const cpfPatterns = [
        /(\d{3})[.\s]*(\d{3})[.\s]*(\d{3})[.\s\-]*(\d{2})/g,
        /\d{11}/g
      ];
      
      const cnpjPatterns = [
        /(\d{2})[.\s]*(\d{3})[.\s]*(\d{3})[.\s\/]*(\d{4})[.\s\-]*(\d{2})/g,
        /\d{14}/g
      ];
      
      let foundDocument = null;
      let documentType = null;
      
      // Buscar CPF com padr√µes flex√≠veis
      for (const pattern of cpfPatterns) {
        const matches = [...text.matchAll(pattern)];
        for (const match of matches) {
          let cpf;
          if (match.length > 5) {
            cpf = match[1] + match[2] + match[3] + match[4];
          } else {
            cpf = match[0].replace(/[^\d]/g, '');
          }
          
          if (cpf.length === 11 && validateCPF(cpf)) {
            foundDocument = cpf;
            documentType = 'cpf';
            break;
          }
        }
        if (foundDocument) break;
      }
      
      // Se n√£o encontrou CPF, buscar CNPJ
      if (!foundDocument) {
        for (const pattern of cnpjPatterns) {
          const matches = [...text.matchAll(pattern)];
          for (const match of matches) {
            let cnpj;
            if (match.length > 6) {
              cnpj = match[1] + match[2] + match[3] + match[4] + match[5];
            } else {
              cnpj = match[0].replace(/[^\d]/g, '');
            }
            
            if (cnpj.length === 14 && validateCNPJ(cnpj)) {
              foundDocument = cnpj;
              documentType = 'cnpj';
              break;
            }
          }
          if (foundDocument) break;
        }
      }
      
      // Mostrar resultado
      const resultSection = document.getElementById('result-section');
      
      if (foundDocument) {
        const formatted = formatDocument(foundDocument, documentType);
        
        // Preencher formul√°rio
        document.getElementById('document-input').value = formatted;
        document.getElementById('document-type').value = documentType;
        
        resultSection.className = 'result-section success';
        resultSection.innerHTML = `
          <h3>‚úÖ Documento Encontrado!</h3>
          <p><strong>${documentType.toUpperCase()}:</strong> ${formatted}</p>
          <div class="ocr-preview">
            <strong>Texto reconhecido:</strong><br>
            ${text}
          </div>
          <div style="margin-top: 15px; text-align: center;">
            <img src="${imageDataUrl}" style="max-width: 100%; height: auto; border-radius: 8px;">
          </div>
          ${generateBarcode(foundDocument, documentType)}
        `;
        
        showToast(`${documentType.toUpperCase()} v√°lido encontrado!`, 'success');
        
      } else {
        resultSection.className = 'result-section error';
        resultSection.innerHTML = `
          <h3>‚ùå Nenhum documento v√°lido encontrado</h3>
          <p>Tente melhorar a ilumina√ß√£o e estabilidade</p>
          <div class="ocr-preview">
            <strong>Texto reconhecido:</strong><br>
            ${text || 'Nenhum texto reconhecido'}
          </div>
          <div style="margin-top: 15px; text-align: center;">
            <img src="${imageDataUrl}" style="max-width: 100%; height: auto; border-radius: 8px;">
          </div>
          <div style="margin-top: 15px; padding: 15px; background: #fef3c7; border-radius: 8px;">
            <strong>üí° Dicas para melhorar:</strong><br>
            ‚Ä¢ Melhore a ilumina√ß√£o<br>
            ‚Ä¢ Mantenha o celular mais est√°vel<br>
            ‚Ä¢ Aproxime mais do documento<br>
            ‚Ä¢ Certifique-se que o CPF/CNPJ est√° vis√≠vel
          </div>
        `;
        
        showToast('Documento n√£o encontrado. Tente novamente.', 'error');
      }
      
      resultSection.classList.remove('hidden');
    }
  </script>
</body>
</html>

